// dashboard.js

document.addEventListener('DOMContentLoaded', () => {
  const saldo_btc = document.getElementById('saldo_btc');
  const saldo_usdt = document.getElementById('saldo_usdt');
  const qtd_input = document.getElementById('qtd_input');
  const ordensList = document.getElementById('ordens-list');
  let historico = [];

  // Simulação de saldo (troque por chamada AJAX se quiser saldo real)
  if (saldo_btc && saldo_usdt) {
    fetch('/api/saldo')
      .then(resp => resp.json())
      .then(data => {
        saldo_btc.textContent = data.btc || "0";
        saldo_usdt.textContent = data.usdt || "0";
      })
      .catch(() => {
        saldo_btc.textContent = "0";
        saldo_usdt.textContent = "0";
      });
  }

  // Função para inserir nova ordem no histórico
  window.confirmarOrdem = function(tipo) {
    let msg = "Tem certeza que deseja executar essa ordem?";
    if (tipo === "buy") msg = "Confirmar compra?";
    if (tipo === "sell") msg = "Confirmar venda?";
    if (tipo === "ia") msg = "Pedir sugestão para a IA?";
    if (tipo === "auto") msg = "Ativar modo automático?";
    if (confirm(msg)) {
      // Aqui você pode chamar AJAX real para enviar ordem pro Flask
      historico.unshift({
        tipo: tipo === "buy" ? "Compra" : tipo === "sell" ? "Venda" : (tipo === "ia" ? "Sugestão IA" : "Automático"),
        ativo: "BTCUSDT",
        valor: qtd_input.value || "0.001",
        preco: "ao vivo",
        hora: new Date().toLocaleTimeString().slice(0,5)
      });
      renderHistorico();
      alert("Ordem executada!");
    }
  }

  function renderHistorico() {
    ordensList.innerHTML = "";
    for (let o of historico) {
      let li = document.createElement('li');
      li.innerHTML = `<b>${o.tipo}</b> ${o.ativo} - ${o.valor} @ ${o.preco} <span style="color:#aaa">${o.hora}</span>`;
      ordensList.appendChild(li);
    }
  }

  renderHistorico();
});
