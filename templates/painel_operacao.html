{% extends "base.html" %}
{% block title %}Painel de OperaÃ§Ãµes â€¢ ClaraVerse{% endblock %}

{% block content %}
<div class="painel-container">
  <div class="topo-painel">
    <h2>ğŸ“Š Painel de OperaÃ§Ãµes</h2>
    <p><strong>Saldo Real:</strong> {{ saldo_real }} USDT</p>
    <p><strong>PreÃ§o BTC/USDT:</strong> {{ preco_atual }} USDT</p>
  </div>

  <div class="box-ia">
    <h3>ğŸ¤– SugestÃ£o da IA Clarinha</h3>
    <p><strong>AÃ§Ã£o sugerida:</strong> {{ sugestao.acao }}</p>

    <div class="sugestoes">
      <div>
        <h4>ğŸ”® Cosmo</h4>
        <p><strong>Sinal:</strong> {{ sugestao.sinal_cosmo.sinal }}</p>
        <p><strong>ConfianÃ§a:</strong> {{ sugestao.sinal_cosmo.confianca }}</p>
        <p><strong>Risco:</strong> {{ sugestao.sinal_cosmo.risco }}</p>
      </div>
      <div>
        <h4>ğŸŒŒ OrÃ¡culo</h4>
        <p><strong>TendÃªncia:</strong> {{ sugestao.visao_oraculo.tendencia }}</p>
        <p><strong>Sentimento:</strong> {{ sugestao.visao_oraculo.sentimento }}</p>
        <p><strong>PontuaÃ§Ã£o:</strong> {{ sugestao.visao_oraculo.pontuacao }}</p>
      </div>
    </div>
  </div>

  <div class="form-operacao">
    <form action="/executar_ordem" method="post" id="formOrdem">
      <label for="tipo">Escolha a operaÃ§Ã£o:</label>
      <select name="tipo" id="tipo" required>
        <option value="COMPRAR">ğŸŸ¢ COMPRAR</option>
        <option value="VENDER">ğŸ”´ VENDER</option>
      </select>

      <label for="quantidade">Quantidade de BTC:</label>
      <input type="number" name="quantidade" id="quantidade" step="0.0001" value="0.001" required>

      <button type="submit">ğŸ’¸ Executar Ordem</button>
    </form>

    <div id="resultadoOrdem" class="resultado-ordem"></div>
  </div>
</div>

<script>
  const form = document.getElementById('formOrdem');
  const resultado = document.getElementById('resultadoOrdem');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const data = new URLSearchParams(formData);

    resultado.innerHTML = "â³ Executando...";

    const res = await fetch('/executar_ordem', {
      method: 'POST',
      body: data
    });

    const json = await res.json();
    if (json.status === 'sucesso') {
      resultado.innerHTML = "âœ… Ordem executada com sucesso!";
    } else {
      resultado.innerHTML = "âŒ Erro: " + json.mensagem;
    }
  });
</script>
{% endblock %}