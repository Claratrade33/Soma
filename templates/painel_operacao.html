{% extends "base.html" %}
{% block title %}Painel de Operações • ClaraVerse{% endblock %}

{% block content %}
<div class="painel-container">
  <div class="topo-painel">
    <h2>📊 Painel de Operações</h2>
    <p><strong>Saldo Real:</strong> {{ saldo_real }} USDT</p>
    <p><strong>Preço BTC/USDT:</strong> {{ preco_atual }} USDT</p>
  </div>

  <div class="box-ia">
    <h3>🤖 Sugestão da IA Clarinha</h3>
    <p><strong>Ação sugerida:</strong> {{ sugestao.acao }}</p>

    <div class="sugestoes">
      <div>
        <h4>🔮 Cosmo</h4>
        <p><strong>Sinal:</strong> {{ sugestao.sinal_cosmo.sinal }}</p>
        <p><strong>Confiança:</strong> {{ sugestao.sinal_cosmo.confianca }}</p>
        <p><strong>Risco:</strong> {{ sugestao.sinal_cosmo.risco }}</p>
      </div>
      <div>
        <h4>🌌 Oráculo</h4>
        <p><strong>Tendência:</strong> {{ sugestao.visao_oraculo.tendencia }}</p>
        <p><strong>Sentimento:</strong> {{ sugestao.visao_oraculo.sentimento }}</p>
        <p><strong>Pontuação:</strong> {{ sugestao.visao_oraculo.pontuacao }}</p>
      </div>
    </div>
  </div>

  <div class="form-operacao">
    <form action="/executar_ordem" method="post" id="formOrdem">
      <label for="tipo">Escolha a operação:</label>
      <select name="tipo" id="tipo" required>
        <option value="COMPRAR">🟢 COMPRAR</option>
        <option value="VENDER">🔴 VENDER</option>
      </select>

      <label for="quantidade">Quantidade de BTC:</label>
      <input type="number" name="quantidade" id="quantidade" step="0.0001" value="0.001" required>

      <button type="submit">💸 Executar Ordem</button>
    </form>

    <div id="resultadoOrdem" class="resultado-ordem"></div>
  </div>
</div>

<script>
  const form = document.getElementById('formOrdem');
  const resultado = document.getElementById('resultadoOrdem');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const data = new URLSearchParams(formData);

    resultado.innerHTML = "⏳ Executando...";

    const res = await fetch('/executar_ordem', {
      method: 'POST',
      body: data
    });

    const json = await res.json();
    if (json.status === 'sucesso') {
      resultado.innerHTML = "✅ Ordem executada com sucesso!";
    } else {
      resultado.innerHTML = "❌ Erro: " + json.mensagem;
    }
  });
</script>
{% endblock %}