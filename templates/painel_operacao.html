<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel de Operações | ClaraVerse</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
</head>
<body class="bg-dark">
    <div class="painel-flex">
        <!-- COLUNA LATERAL -->
        <aside class="painel-sidebar">
            <div class="painel-logo">
                <span>ClaraVerse</span>
            </div>
            <div class="user-box">
                <b>Usuário:</b> {{ user.username }}<br>
                <b>E-mail:</b> {{ user.email }}
            </div>
            <div class="saldo-card">
                <div><b>BTC:</b> <span>{{ saldo_btc }}</span></div>
                <div><b>USDT:</b> <span>{{ saldo_usdt }}</span></div>
            </div>
            <div class="btns-operacoes">
                <button class="btn btn-buy" onclick="confirmarOrdem('compra')">Comprar</button>
                <button class="btn btn-sell" onclick="confirmarOrdem('venda')">Vender</button>
                <button class="btn btn-main" onclick="obterSugestaoGPT()">Sugestão IA</button>
                <button class="btn btn-auto" onclick="executarOrdemAutomatico()">Automático</button>
                <a href="{{ url_for('configurar') }}" class="btn btn-sec">Configurar</a>
                <a href="{{ url_for('logout') }}" class="btn btn-sec">Sair</a>
            </div>
            <div id="gpt-sugestao" class="gpt-box painel-card"></div>
        </aside>

        <!-- ÁREA PRINCIPAL -->
        <main class="painel-main">
            <div class="painel-card" style="padding:0;">
                <div id="tv_chart" style="height:350px;"></div>
            </div>
            <div class="painel-ops">
                <div class="painel-card historico">
                    <h3>Histórico de Operações</h3>
                    <ul id="historico-list"></ul>
                </div>
                <div class="painel-card status">
                    <h3>Status & Mensagens</h3>
                    <div id="mensagem-ordem"></div>
                </div>
            </div>
            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                <ul class="flash-messages">
                {% for category, message in messages %}
                  <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
                </ul>
              {% endif %}
            {% endwith %}
        </main>
    </div>

    <script>
        // TradingView Widget
        new TradingView.widget({
            "container_id": "tv_chart",
            "width": "100%",
            "height": 350,
            "symbol": "BINANCE:BTCUSDT",
            "interval": "30",
            "timezone": "America/Sao_Paulo",
            "theme": "dark",
            "style": "1",
            "locale": "br",
            "toolbar_bg": "#222",
            "hide_side_toolbar": false,
            "allow_symbol_change": false,
            "save_image": false
        });
    </script>
    <script src="{{ url_for('static', filename='dashboard.js') }}"></script>
</body>
</html>
