<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>ClaraVerse ‚Ä¢ Painel de Opera√ß√µes</title>
  <link rel="stylesheet" href="/static/style.css">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
  <div class="topo">
    <span class="logo">üìà ClaraVerse ‚Ä¢ Opera√ß√µes ao Vivo</span>
    <a href="/logout" class="btn-sair">Sair</a>
  </div>

  <div class="painel">
    <!-- Gr√°fico TradingView -->
    <div class="grafico">
      <iframe src="https://s.tradingview.com/widgetembed/?frameElementId=tradingview_12345&symbol=BINANCE:BTCUSDT&interval=1&theme=dark&style=1&locale=br"
        frameborder="0" width="100%" height="400" allowtransparency="true"></iframe>
    </div>

    <!-- Indicadores -->
    <div class="indicadores">
      <h3>üìä Indicadores em Tempo Real</h3>
      <ul>
        <li><strong>Pre√ßo:</strong> <span id="preco">Carregando...</span> USDT</li>
        <li><strong>RSI:</strong> <span id="rsi">-</span></li>
        <li><strong>Suporte:</strong> <span id="suporte">-</span></li>
        <li><strong>Resist√™ncia:</strong> <span id="resistencia">-</span></li>
        <li><strong>Volume:</strong> <span id="volume">-</span></li>
      </ul>
    </div>

    <!-- IA Clarinha -->
    <div class="ia">
      <h3>ü§ñ Sugest√£o da Clarinha</h3>
      <p><strong>Entrada:</strong> <span id="entrada">-</span></p>
      <p><strong>Alvo:</strong> <span id="alvo">-</span></p>
      <p><strong>Stop:</strong> <span id="stop">-</span></p>
      <p><strong>Confian√ßa:</strong> <span id="confianca">-</span></p>
    </div>

    <!-- Bot√µes -->
    <div class="botoes">
      <button onclick="executarOrdem('compra')">üü© Entrar (Comprar)</button>
      <button onclick="executarOrdem('venda')">üü• Sair (Vender)</button>
      <button onclick="recarregarIA()">üîÅ Atualizar IA</button>
    </div>
  </div>

  <script>
    async function carregarDados() {
      try {
        const res = await axios.get('/dados_mercado');
        const { preco, rsi, suporte, resistencia, volume } = res.data;
        document.getElementById("preco").innerText = preco;
        document.getElementById("rsi").innerText = rsi;
        document.getElementById("suporte").innerText = suporte;
        document.getElementById("resistencia").innerText = resistencia;
        document.getElementById("volume").innerText = volume;
      } catch (err) {
        console.error('Erro ao carregar mercado:', err);
      }
    }

    async function recarregarIA() {
      try {
        const res = await axios.get('/sugestao_ia');
        const { entrada, alvo, stop, confianca } = res.data;
        document.getElementById("entrada").innerText = entrada;
        document.getElementById("alvo").innerText = alvo;
        document.getElementById("stop").innerText = stop;
        document.getElementById("confianca").innerText = confianca;
      } catch (err) {
        console.error('Erro IA:', err);
      }
    }

    async function executarOrdem(tipo) {
      try {
        const res = await axios.post('/executar_ordem', { tipo });
        alert(res.data.mensagem);
      } catch (err) {
        alert('Erro ao executar ordem');
      }
    }

    carregarDados();
    recarregarIA();
    setInterval(carregarDados, 15000);
    setInterval(recarregarIA, 30000);
  </script>
</body>
</html>
