@app.route('/painel_operacao')
def painel_operacao():
    user = get_current_user()
    if not user:
        return redirect(url_for('login'))

    saldo = "Chaves n√£o configuradas"
    if user.api_key and user.api_secret:
        try:
            client = Client(user.api_key, user.api_secret)
            balance = client.get_asset_balance(asset='USDT')
            saldo = round(float(balance['free']), 2)
        except Exception as e:
            print(f"Erro ao conectar na Binance: {e}")  # <- Log detalhado
            saldo = "Erro ao conectar"

    try:
        ia = ClarinhaIA(api_key=user.api_key, api_secret=user.api_secret)
        sugestao = ia.analisar()
    except Exception as e:
        print(f"Erro ao consultar IA: {e}")  # <- Log da IA
        sugestao = {"sinal": "Erro", "alvo": "-", "stop": "-", "confianca": 0}

    return render_template("painel_operacao.html", saldo=saldo, sugestao=sugestao)
