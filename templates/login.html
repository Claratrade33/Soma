@app.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'POST':
        u = request.form.get('username', '').strip()
        p = request.form.get('password', '').strip()

        if not u or not p:
            flash('Preencha todos os campos.', 'error')
            return redirect(url_for('login'))

        user = User.query.filter_by(username=u).first()
        if user and check_password_hash(user.password, p):
            session['user_id'] = user.id
            session.permanent = True
            flash(f'Bem-vindo, {user.username}!', 'success')
            return redirect(url_for('painel_operacao'))
        else:
            flash('Credenciais inv√°lidas. Tente novamente.', 'error')
            return redirect(url_for('login'))

    return render_template('login.html')