<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>ConfiguraÃ§Ã£o de Chaves | Soma</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-dark">

  <div class="container config-container">
    <h1 class="logo-title">ğŸ” ConfiguraÃ§Ã£o de Chaves</h1>

    <form id="form-configuracao" onsubmit="salvarChaves(event)">
      <label for="binance_key">ğŸ“˜ Binance API Key:</label>
      <input type="text" id="binance_key" name="binance_key" required>

      <label for="binance_secret">ğŸ“• Binance API Secret:</label>
      <input type="password" id="binance_secret" name="binance_secret" required>

      <label for="gpt_key">ğŸ§  Chave GPT:</label>
      <input type="password" id="gpt_key" name="gpt_key" required>

      <button type="submit" class="btn btn-primary">Salvar e Testar</button>
    </form>

    <div id="mensagem-config" style="margin-top: 1rem;"></div>
  </div>

  <script>
    function salvarChaves(event) {
      event.preventDefault();
      document.getElementById('mensagem-config').innerHTML = "ğŸ”„ Testando conexÃ£o...";

      const dados = {
        binance_key: document.getElementById('binance_key').value,
        binance_secret: document.getElementById('binance_secret').value,
        gpt_key: document.getElementById('gpt_key').value
      };

      axios.post('/salvar_chaves', dados)
      .then(resp => {
        if (resp.data.sucesso) {
          document.getElementById('mensagem-config').innerHTML = "<b>âœ… Chaves vÃ¡lidas e salvas!</b> Redirecionando...";
          setTimeout(() => window.location.href = "/painel", 1500);
        } else {
          document.getElementById('mensagem-config').innerHTML = "<span class='error'>âŒ Erro: " + resp.data.mensagem + "</span>";
        }
      })
      .catch(err => {
        const msg = err.response?.data?.mensagem || "Erro ao testar chaves.";
        document.getElementById('mensagem-config').innerHTML = "<span class='error'>âŒ " + msg + "</span>";
      });
    }
  </script>

</body>
</html>
